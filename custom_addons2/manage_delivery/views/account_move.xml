<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="inherit_account_move_form" model="ir.ui.view">
        <field name="name">inherit.account.move.form</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='payment_reference']" position="after">
                <field name="stock_picking_id"/>
            </xpath>

            <xpath expr="//header" position="inside">
                <button name="send_to_delivery" type="object"
                        string="Send To Delivery" class="oe_highlight"
                        attrs="{'invisible':['|','|',('state','=','draft'),('delivery_status','!=','1'),('move_type','!=','out_invoice')]}"/>
            </xpath>

            <xpath expr="//page[last()]" position="after">
                <page string="Delivery Information" attrs="{'invisible':[('move_type','!=','out_invoice')]}">
                    <group>
                        <group string="Address Information">
                            <field name="mobile"/>
                            <field name="building_floor"/>
                            <field name="street"/>
                            <field name="special_mark"/>
                            <field name="area_region"/>
                            <field name="zone"/>
                            <field name="delivery_moves" invisible="1"/>
                        </group>
                        <group string="Order Information">
                            <field name="delivery_status" widget="badge"
                                   decoration-danger="delivery_status == '4'"
                                   decoration-success="delivery_status == '3'"/>
                            <field name="delivery_boy"/>
                            <field name="transportation"/>
                            <field name="send_date"/>
                            <field name="arrived_date"/>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <record id="inherit_account_move_tree" model="ir.ui.view">
        <field name="name">inherit.account.move.tree</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_out_invoice_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='state']" position="after">
                <field name="delivery_boy" optional="show"/>
                <field name="delivery_status" optional="show"/>
            </xpath>
        </field>
    </record>


    <record id="action_send_delivery_move_out_invoice_type"
            model="ir.actions.act_window">
        <field name="name">Invoices</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="view_id" ref="account.view_out_invoice_tree"/>
        <field name="search_view_id" ref="account.view_account_invoice_filter"/>
        <field name="domain">[('delivery_status', '=', '2')]</field>
        <field name="context">{'default_move_type': 'out_invoice'}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a customer invoice
            </p>
            <p>
                Create invoices, register payments and keep track of the
                discussions with your customers.
            </p>
        </field>
    </record>

    <record id="action_delivery_move_out_invoice_type"
            model="ir.actions.act_window">
        <field name="name">Invoices</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="view_id" ref="account.view_out_invoice_tree"/>
        <field name="search_view_id" ref="account.view_account_invoice_filter"/>
        <field name="domain">[('delivery_status', '=', '3')]</field>
        <field name="context">{'default_move_type': 'out_invoice'}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a customer invoice
            </p>
            <p>
                Create invoices, register payments and keep track of the
                discussions with your customers.
            </p>
        </field>
    </record>

    <menuitem id="invoices_send_delivery_menu"
              name="Invoices Send To Delivery"
              action="manage_delivery.action_send_delivery_move_out_invoice_type"
              parent="manage_delivery_orders_menu"
              sequence="1"/>

    <menuitem id="delivery_invoices_menu"
              name="Delivery Invoices"
              action="manage_delivery.action_delivery_move_out_invoice_type"
              parent="manage_delivery_orders_menu"
              sequence="4"/>
</odoo>
